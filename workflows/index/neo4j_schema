// Neo4j schema for code relationships (updated syntax for Neo4j 2025.05+)
// Updated schema for Neo4j Community Edition
// Unique constraints are supported in Community Edition

CREATE CONSTRAINT file_path_constraint IF NOT EXISTS FOR (file:File) REQUIRE file.path IS UNIQUE;

CREATE CONSTRAINT function_name_path_line IF NOT EXISTS FOR (function:Function) 
REQUIRE (function.name, function.filepath, function.start_line) IS UNIQUE;

CREATE CONSTRAINT class_name_path_line IF NOT EXISTS FOR (class:Class)
REQUIRE (class.name, class.filepath, class.start_line) IS UNIQUE;

CREATE CONSTRAINT variable_name_path_line IF NOT EXISTS FOR (variable:Variable)
REQUIRE (variable.name, variable.filepath, variable.line_number) IS UNIQUE;

// Create indexes for better query performance
CREATE INDEX function_name_idx IF NOT EXISTS FOR (f:Function) ON (f.name);
CREATE INDEX file_language_idx IF NOT EXISTS FOR (f:File) ON (f.language);

// Create index on File nodes if it doesn't exist already
CREATE INDEX file_filepath_idx IF NOT EXISTS FOR (f:File) ON (f.filepath);

// No need for a relationship constraint - just ensure we have the right node constraints
CREATE CONSTRAINT file_filepath_unique IF NOT EXISTS
FOR (f:File) 
REQUIRE f.filepath IS NOT NULL AND f.filepath IS UNIQUE;